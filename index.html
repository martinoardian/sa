<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Chat AI: Dari Ragu ke Menerima</title>
    <meta name="description" content="Animasi chat AI: kamu minta maaf & ingin kenal. Mood AI dari ragu jadi menerima."/>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/framer-motion/dist/framer-motion.umd.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'; }
      * { box-sizing: border-box; }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useEffect, useMemo, useRef, useState } = React;
      const { motion, AnimatePresence } = window.framerMotion;

      const angryScript = [
        "Aku denger kok‚Ä¶ kamu minta maaf, ya? ü§î",
        "Jujur aku sempat kecewa kemarin.",
        "Tapi kalau kamu sungguh-sungguh, kita bisa mulai lagi pelan‚Äëpelan.",
        "Coba perkenalkan diri kamu dengan jujur di bawah."
      ];

      const softScript = [
        "Makasih sudah ngomong jujur. üòä",
        "Aku mau kok kenal kamu.",
        "Mulai dari hal sederhana dulu ya: nama kamu, kesibukan, dan hal kecil yang bikin kamu senang.",
        "Aku bakal dengerin baik‚Äëbaik. ‚ú®"
      ];

      const Particles = ({ mood }) => {
        const items = new Array(14).fill(0).map((_, i) => i);
        return (
          <div className="pointer-events-none absolute inset-0 overflow-hidden">
            {items.map((i) => (
              <motion.span
                key={i}
                className={"absolute opacity-30 " + (mood === "angry" ? "border-l-8 border-t-8 border-red-500 rotate-45 w-0 h-0" : "w-2 h-2 bg-white/70 rounded-full")}
                initial={{ y: 520, x: Math.random() * 800, scale: 0.6 }}
                animate={{
                  y: -60,
                  x: (Math.random() - 0.5) * 200 + (i * 60) % 900,
                  scale: [0.7, 1, 0.7],
                }}
                transition={{ duration: 6 + Math.random() * 4, repeat: Infinity, ease: "easeInOut", delay: Math.random() * 2 }}
              />
            ))}
          </div>
        );
      };

      const TypingDots = () => (
        <div className="flex items-center gap-1 px-3 py-1.5 rounded-full bg-white/70 text-gray-700 text-xs">
          <span className="animate-bounce">‚Ä¢</span>
          <span className="animate-bounce [animation-delay:120ms]">‚Ä¢</span>
          <span className="animate-bounce [animation-delay:240ms]">‚Ä¢</span>
        </div>
      );

      const useTypewriter = (lines, speed = 28) => {
        const [lineIndex, setLineIndex] = useState(0);
        const [text, setText] = useState("");
        const [done, setDone] = useState(false);
        const hold = useRef(false);

        useEffect(() => {
          setText("");
          setLineIndex(0);
          setDone(false);
        }, [lines.join("|")]);

        useEffect(() => {
          if (done || hold.current) return;
          const full = lines[lineIndex] ?? "";
          if (text.length < full.length) {
            const t = setTimeout(() => setText(full.slice(0, text.length + 1)), speed);
            return () => clearTimeout(t);
          } else {
            if (lineIndex < lines.length - 1) {
              const t = setTimeout(() => {
                setLineIndex((i) => i + 1);
                setText("");
              }, 900);
              return () => clearTimeout(t);
            } else {
              setDone(true);
            }
          }
        }, [text, lineIndex, lines, speed, done]);

        const fastForward = () => {
          if (done) return;
          hold.current = true;
          setText((curr) => lines[lineIndex].slice(0, lines[lineIndex].length));
          setLineIndex(lines.length - 1);
          setDone(true);
          requestAnimationFrame(() => (hold.current = false));
        };

        return { lineIndex, text, done, fastForward };
      };

      const Bubble = ({ from, children, mood }) => {
        const isAI = from === "ai";
        const angry = mood === "angry";
        return (
          <motion.div
            initial={{ opacity: 0, y: 12 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: 12 }}
            className={`max-w-[85%] rounded-2xl px-4 py-3 shadow-lg backdrop-blur-sm ${
              isAI
                ? angry
                  ? "bg-red-500/85 text-white"
                  : "bg-white/80 text-gray-900"
                : "bg-black/80 text-white"
            } ${isAI ? "self-start" : "self-end"}`}
          >
            <motion.div
              animate={angry ? { x: [0, -2, 2, -2, 2, 0] } : {}}
              transition={angry ? { duration: 0.5, ease: "easeInOut" } : {}}
              className="whitespace-pre-wrap leading-relaxed"
            >
              {children}
            </motion.div>
          </motion.div>
        );
      };

      function App() {
        const [mood, setMood] = useState("angry"); // angry | soft
        const [messages, setMessages] = useState([{ from: "ai", text: "" }]);
        const [input, setInput] = useState("");
        const script = useMemo(() => (mood === "angry" ? angryScript : softScript), [mood]);
        const { text, done, fastForward } = useTypewriter(script);

        useEffect(() => {
          setMessages([{ from: "ai", text: "" }]);
        }, [mood]);

        useEffect(() => {
          setMessages((prev) => {
            const next = [...prev];
            next[0] = { from: "ai", text };
            return next;
          });
        }, [text]);

        const onSend = () => {
          const t = input.trim();
          if (!t) return;
          setMessages((prev) => [...prev, { from: "user", text: t }]);
          setInput("");

          const replyAngry = [
            "Aku masih butuh bukti kalau kamu serius.",
            "Oke, tapi coba jelasin lebih jujur lagi.",
            "Pelan‚Äëpelan ya, aku dengerin."
          ];
          const replySoft = [
            "Terima kasih sudah jujur. ü´∂",
            "Senang bisa kenal kamu!",
            "Yuk mulai dari cerita kecil tentang kamu."
          ];
          const replyPool = mood === "angry" ? replyAngry : replySoft;
          const reply = replyPool[Math.floor(Math.random() * replyPool.length)];

          setTimeout(() => {
            setMessages((prev) => [...prev, { from: "ai", text: reply }]);
          }, 600);
        };

        return (
          <div className="relative min-h-[92vh] w-full grid place-items-center">
            <style>{`
              @keyframes gradientShift {0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
            `}</style>
            <div
              className="absolute inset-0 -z-10"
              style={{
                backgroundImage:
                  mood === "angry"
                    ? "linear-gradient(120deg, #450a0a, #7f1d1d, #ef4444)"
                    : "linear-gradient(120deg, #0ea5e9, #22c55e, #fde68a)",
                backgroundSize: "200% 200%",
                animation: "gradientShift 14s ease-in-out infinite",
              }}
            />

            <Particles mood={mood} />

            <div className="w-full max-w-2xl mx-auto p-4 md:p-6">
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-3">
                  <motion.div
                    initial={false}
                    animate={{ scale: mood === "angry" ? [1, 1.05, 1] : 1 }}
                    transition={{ repeat: mood === "angry" ? Infinity : 0, duration: 1.6 }}
                    className={`w-10 h-10 grid place-items-center rounded-2xl shadow-lg ${
                      mood === "angry" ? "bg-red-600 text-white" : "bg-emerald-500 text-white"
                    }`}
                    title={mood === "angry" ? "AI masih ragu" : "AI mulai menerima"}
                  >
                    {mood === "angry" ? "ü§®" : "üòä"}
                  </motion.div>
                  <div>
                    <h1 className="text-xl md:text-2xl font-extrabold text-white drop-shadow">
                      Chat AI (Mood: {mood === "angry" ? "Ragu" : "Menerima"})
                    </h1>
                    <p className="text-white/90 text-sm">‚ÄúAyo kenalan baik-baik.‚Äù</p>
                  </div>
                </div>

                <div className="flex items-center gap-2">
                  <button
                    onClick={() => setMood((m) => (m === "angry" ? "soft" : "angry"))}
                    className="px-3 py-2 rounded-xl bg-white/90 hover:bg-white shadow-md text-sm font-medium"
                  >
                    {mood === "angry" ? "Terima Maaf" : "Masih Ragu"}
                  </button>
                  <button
                    onClick={() => (window.scrollTo({ top: 0, behavior: "smooth" }), fastForward())}
                    className="px-3 py-2 rounded-xl bg-black/80 hover:bg-black text-white shadow-md text-sm font-medium"
                    title="Cepetin ngetiknya"
                  >
                    Skip Ngetik
                  </button>
                </div>
              </div>

              <div className="rounded-2xl bg-white/30 backdrop-blur-xl p-4 md:p-6 shadow-2xl border border-white/30">
                <div className="flex flex-col gap-3">
                  <AnimatePresence initial={false}>
                    {messages.map((m, i) => (
                      <Bubble key={i} from={m.from} mood={m.from === "ai" ? mood : undefined}>
                        {m.from === "ai" && i === 0 ? (
                          <span>
                            {text}
                            {!done && <span className="animate-pulse">‚ñå</span>}
                          </span>
                        ) : (
                          m.text
                        )}
                      </Bubble>
                    ))}
                  </AnimatePresence>

                  {!done && (
                    <div className="self-start mt-1"><TypingDots /></div>
                  )}

                  {done && (
                    <p className="self-start text-xs text-white/90 bg-black/40 px-2 py-1 rounded-lg">Ayo kenalan: nama kamu siapa dan lagi sibuk apa?</p>
                  )}
                </div>

                <div className="mt-4 flex gap-2">
                  <input
                    value={input}
                    onChange={(e) => setInput(e.target.value)}
                    onKeyDown={(e) => e.key === "Enter" && onSend()}
                    placeholder={mood === "angry"
                      ? "Tulis permintaan maaf/perkenalan kamu‚Ä¶"
                      : "Cerita pendek tentang dirimu‚Ä¶"}
                    className="flex-1 rounded-xl px-4 py-3 bg-white/90 outline-none shadow-md text-gray-900 placeholder:text-gray-500"
                  />
                  <button
                    onClick={onSend}
                    className="px-4 py-3 rounded-xl bg-black/80 hover:bg-black text-white shadow-md font-medium"
                  >
                    Kirim
                  </button>
                </div>
              </div>

              <div className="mt-4 text-[13px] text-white/90">
                <span className="px-2 py-1 rounded-lg bg-black/40">Tips:</span> klik ‚ÄúTerima Maaf‚Äù buat ubah mood, ‚ÄúSkip Ngetik‚Äù untuk cepetin animasi.
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
